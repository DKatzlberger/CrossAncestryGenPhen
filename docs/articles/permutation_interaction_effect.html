<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Subset interaction effect â€¢ CrossAncestryGenPhen</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Subset interaction effect">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CrossAncestryGenPhen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DKatzlberger/CrossAncestryGenPhen" aria-label="GitHub repository"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Subset interaction effect</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DKatzlberger/CrossAncestryGenPhen/blob/HEAD/vignettes/permutation_interaction_effect.Rmd" class="external-link"><code>vignettes/permutation_interaction_effect.Rmd</code></a></small>
      <div class="d-none name"><code>permutation_interaction_effect.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here we showcase how permutation testing is used to assess if
genotype-phenotype relationships differ across ancestries. In omics
research frameworks like <code>limma</code> are gold standard to test
for differetnial expressed genes. However, such frameworks are build on
biological and statistical assuptions on the underlying data. In
permutation testing theses assumptions are reduced, because pvalues are
derived by modelling an empirical null distribution. In case of
interaction effects of the form <code>phenotype x ancestry</code>, the
ancestry label is permuted creating a null, which assumes no effect by
ancestry.</p>
<div class="section level3">
<h3 id="overrepresentation-of-eur-ancestry">Overrepresentation of EUR ancestry<a class="anchor" aria-label="anchor" href="#overrepresentation-of-eur-ancestry"></a>
</h3>
<p>In omics research EUR ancestry is often overrepresented compared to
other ancestries. Hence, data of non-Europeans is often sparse and can
effect the discovery of true effects. The
framework<code>CrossAncestryGenPhen</code> tries to be fair by
subsampling the overrepresented ancestry to match the sample size of the
underrepresented ancestry. The following code snippet showcases such an
imbalance on a simulated dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://DKatzlberger.github.io/CrossAncestryGenPhen">CrossAncestryGenPhen</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example data </span></span>
<span><span class="va">n_features</span> <span class="op">&lt;-</span> <span class="fl">100</span>  </span>
<span><span class="va">n_EUR</span> <span class="op">&lt;-</span> <span class="fl">600</span> </span>
<span><span class="va">n_AFR</span> <span class="op">&lt;-</span> <span class="fl">40</span>  </span>
<span></span>
<span><span class="va">id_EUR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sample_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_EUR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id_AFR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Sample_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_AFR</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Expression matrices for EUR and AFR ancestries</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_EUR</span> <span class="op">*</span> <span class="va">n_features</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_EUR</span>, ncol <span class="op">=</span> <span class="va">n_features</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_AFR</span> <span class="op">*</span> <span class="va">n_features</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_AFR</span>, ncol <span class="op">=</span> <span class="va">n_features</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Feature_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_features</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Metadata for EUR and AFR ancestries</span></span>
<span><span class="co"># EUR: overrepresented compared to AFR</span></span>
<span><span class="va">MX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">400</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ancestry <span class="op">=</span> <span class="st">"EUR"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># AFR: underrepresented compared to EUR</span></span>
<span><span class="va">MY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ancestry <span class="op">=</span> <span class="st">"AFR"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rownames of matrix must be smaple ids</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">MX</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id_EUR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">MY</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id_AFR</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="../reference/plot_imbalanced_groups.html">plot_imbalanced_groups</a></span><span class="op">(</span></span>
<span>  MX <span class="op">=</span> <span class="va">MX</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">MY</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Imbalanced ancestry groups"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Ancestry group"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"No. of patients"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="permutation_interaction_effect_files/figure-html/data%20setup-1.png" alt="Bar plot showing condition imbalance across ancestries" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="single-subset-run">Single subset run<a class="anchor" aria-label="anchor" href="#single-subset-run"></a>
</h2>
<div class="section level3">
<h3 id="stratification-step">Stratification step<a class="anchor" aria-label="anchor" href="#stratification-step"></a>
</h3>
<p>The function <code>split_stratified_ancestry_sets</code> creates a
stratified subset to account for sample size but also control for the
phenotype imbalance in the underrepresented ancestry. The idea is to
create a EUR <code>train set</code>, which is the remaining EUR cohort
after subsampling, a EUR-subset <code>test set</code> (mimicking the
underrepresented ancestry) based on the compared ancestry
<code>inferecnce set</code>. The output will contain <code>train</code>,
<code>test</code> and <code>inference</code> sets and additional
information on used strata. Each subset contains a gene expression
matrix (<code>$X</code>), a metadata frame (<code>$M</code>) and the
used ids (<code>$ids</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g_col</span> <span class="op">&lt;-</span> <span class="st">"condition"</span> <span class="co"># Column with group information (stratified for)</span></span>
<span><span class="va">a_col</span> <span class="op">&lt;-</span> <span class="st">"ancestry"</span>  <span class="co"># Column with ancestry information</span></span>
<span></span>
<span><span class="co"># Split the data into stratified sets</span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_stratified_ancestry_sets.html">split_stratified_ancestry_sets</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  MX <span class="op">=</span> <span class="va">MX</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">MY</span>,</span>
<span>  g_col <span class="op">=</span> <span class="va">g_col</span>,</span>
<span>  a_col <span class="op">=</span> <span class="va">a_col</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visulaize stratified sets</span></span>
<span><span class="fu"><a href="../reference/plot_stratified_sets.html">plot_stratified_sets</a></span><span class="op">(</span></span>
<span>  MX <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">test</span><span class="op">$</span><span class="va">M</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">inference</span><span class="op">$</span><span class="va">M</span>,</span>
<span>  MR <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">M</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Stratified ancestry sets"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Ancestry group"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"No. of patients"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="permutation_interaction_effect_files/figure-html/stratification-1.png" alt="Bar plot showing balanced subset" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Katzlberger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
