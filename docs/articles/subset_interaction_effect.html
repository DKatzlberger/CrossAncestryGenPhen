<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Subset interaction effect • CrossAncestryGenPhen</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Subset interaction effect">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CrossAncestryGenPhen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DKatzlberger/CrossAncestryGenPhen" aria-label="GitHub repository"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Subset interaction effect</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DKatzlberger/CrossAncestryGenPhen/blob/HEAD/vignettes/subset_interaction_effect.Rmd" class="external-link"><code>vignettes/subset_interaction_effect.Rmd</code></a></small>
      <div class="d-none name"><code>subset_interaction_effect.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In omics research frameworks like <code>limma</code> are gold
standard to test for differetnial expressed genes. However inbalances of
the input data might increase the FPR of such linear models. A subset
approach should mitigate this problem.</p>
<div class="section level3">
<h3 id="overrepresentation-of-eur-ancestry">Overrepresentation of EUR ancestry<a class="anchor" aria-label="anchor" href="#overrepresentation-of-eur-ancestry"></a>
</h3>
<p>In omics research EUR ancestry is often overrepresented compared to
other ancestries. Hence, data of non-Europeans is often sparse and can
effect the discovery of true effects. The
framework<code>CrossAncestryGenPhen</code> tries to be fair by
subsampling the overrepresented ancestry to match the sample size of the
underrepresented ancestry. The following code snippet showcases such an
imbalance on a simulated dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://DKatzlberger.github.io/CrossAncestryGenPhen">CrossAncestryGenPhen</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example data </span></span>
<span><span class="va">n_features</span> <span class="op">&lt;-</span> <span class="fl">100</span>  </span>
<span><span class="va">n_EUR</span> <span class="op">&lt;-</span> <span class="fl">600</span> </span>
<span><span class="va">n_AFR</span> <span class="op">&lt;-</span> <span class="fl">40</span>  </span>
<span></span>
<span><span class="va">id_EUR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"EUR_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_EUR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">id_AFR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"AFR_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_AFR</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lambda_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">3</span><span class="op">)</span>,    <span class="co"># ~20 low-count features</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">20</span><span class="op">)</span>,   <span class="co"># ~60 medium-count features</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">120</span><span class="op">)</span>   <span class="co"># ~20 high-count features</span></span>
<span>  <span class="op">)</span>,</span>
<span>  size <span class="op">=</span> <span class="va">n_features</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Expression matrices for EUR and AFR ancestries</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lambda_features</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lam</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n_EUR</span>, lambda <span class="op">=</span> <span class="va">lam</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lambda_features</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lam</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n_AFR</span>, lambda <span class="op">=</span> <span class="va">lam</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Feature_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_features</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Metadata for EUR and AFR ancestries</span></span>
<span><span class="co"># EUR: overrepresented compared to AFR</span></span>
<span><span class="va">MX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">400</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Case"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ancestry <span class="op">=</span> <span class="st">"EUR"</span>,</span>
<span>  sex      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>, <span class="va">n_EUR</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  age      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_EUR</span>, mean <span class="op">=</span> <span class="fl">50</span>, sd <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># AFR: underrepresented compared to EUR</span></span>
<span><span class="va">MY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Case"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ancestry <span class="op">=</span> <span class="st">"AFR"</span>,</span>
<span>  sex      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>, <span class="va">n_AFR</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  age      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_AFR</span>, mean <span class="op">=</span> <span class="fl">48</span>, sd <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rownames of matrix must be smaple ids</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">MX</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id_EUR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">MY</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">id_AFR</span></span>
<span></span>
<span></span>
<span><span class="co"># Spike in effect in AFR Case (strong effect, but only for half of AFR cases)</span></span>
<span><span class="co"># AFR Case: strong effect, half of cases</span></span>
<span><span class="va">afr_case_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">MY</span><span class="op">$</span><span class="va">condition</span> <span class="op">==</span> <span class="st">"Case"</span><span class="op">)</span></span>
<span><span class="va">afr_spike_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">afr_case_idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">afr_case_idx</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="va">afr_spike_idx</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">afr_spike_idx</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">afr_spike_idx</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span>, lambda <span class="op">=</span> <span class="fl">80</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># EUR Case: weaker effect, 20% of cases</span></span>
<span><span class="va">eur_case_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">MX</span><span class="op">$</span><span class="va">condition</span> <span class="op">==</span> <span class="st">"Case"</span><span class="op">)</span></span>
<span><span class="va">eur_spike_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">eur_case_idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">eur_case_idx</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">[</span><span class="va">eur_spike_idx</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">eur_spike_idx</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">eur_spike_idx</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span>, lambda <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot imbalance</span></span>
<span><span class="fu"><a href="../reference/plot_imbalanced_groups.html">plot_imbalanced_groups</a></span><span class="op">(</span></span>
<span>  MX <span class="op">=</span> <span class="va">MX</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">MY</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Imbalanced ancestry groups"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Ancestry"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"No. of patients"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot features</span></span>
<span><span class="fu"><a href="../reference/plot_feature.html">plot_feature</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>, </span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>, </span>
<span>  MX <span class="op">=</span> <span class="va">MX</span>, </span>
<span>  MY <span class="op">=</span> <span class="va">MY</span>, </span>
<span>  x_var <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Feature counts"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Ancestry"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Z-score"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="subset_interaction_effect_files/figure-html/data%20setup-1.png" alt="Sample imbalance" width="50%"><img src="subset_interaction_effect_files/figure-html/data%20setup-2.png" alt="Sample imbalance" width="50%"></p>
</div>
<div class="section level3">
<h3 id="contrasts-in-limma_interaction_effect">Contrasts in <code>limma_interaction_effect</code><a class="anchor" aria-label="anchor" href="#contrasts-in-limma_interaction_effect"></a>
</h3>
<p>The function <code><a href="../reference/limma_interaction_effect.html">limma_interaction_effect()</a></code> fits a 2 × 2
design (two groups × two ancestries) and evaluates <strong>four main
contrasts</strong> plus the <strong>interaction</strong>.<br>
Here is a summary of what each contrast represents:</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="27%">
<col width="58%">
</colgroup>
<thead><tr class="header">
<th>Coef type</th>
<th>Formula</th>
<th>Interpretation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>baseline_1</strong></td>
<td><code>G1.A2 – G1.A1</code></td>
<td>Ancestry effect (A2 vs. A1) <strong>within group G1</strong>.</td>
</tr>
<tr class="even">
<td><strong>baseline_2</strong></td>
<td><code>G2.A2 – G2.A1</code></td>
<td>Ancestry effect (A2 vs. A1) <strong>within group G2</strong>.</td>
</tr>
<tr class="odd">
<td><strong>relationship_1</strong></td>
<td><code>G2.A1 – G1.A1</code></td>
<td>Group effect (G2 vs. G1) <strong>within ancestry A1</strong>.</td>
</tr>
<tr class="even">
<td><strong>relationship_2</strong></td>
<td><code>G2.A2 – G1.A2</code></td>
<td>Group effect (G2 vs. G1) <strong>within ancestry A2</strong>.</td>
</tr>
<tr class="odd">
<td><strong>interaction</strong></td>
<td><code>(G2.A2 – G1.A2) – (G2.A1 – G1.A1)</code></td>
<td>Does the <strong>group effect differ by ancestry</strong>? (group ×
ancestry interaction).</td>
</tr>
</tbody>
</table>
<ul>
<li>
<strong>G1 / G2</strong> = the two levels of your <code>g_col</code>
variable (e.g. Control / Case).<br>
</li>
<li>
<strong>A1 / A2</strong> = the two ancestries provided
(<code>MX == A1</code> and <code>MY == A2</code>).</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/limma_interaction_effect.html">limma_interaction_effect</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  MX <span class="op">=</span> <span class="va">MX</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">MY</span>,</span>
<span>  g_col <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  a_col <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>  use_voom <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear model summary:</span></span>
<span><span class="co">#&gt; Formula:        ~0 + groups + sex + age</span></span>
<span><span class="co">#&gt; Groups:         Control.EUR  Case.EUR  Control.AFR  Case.AFR</span></span>
<span><span class="co">#&gt; Baseline:       Control.AFR - Control.EUR  Case.AFR - Case.EUR</span></span>
<span><span class="co">#&gt; Relationship:   Case.EUR - Control.EUR  Case.AFR - Control.AFR</span></span>
<span><span class="co">#&gt; Interaction:    (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    coef_type                  contrast   feature       T_obs   p_value</span></span>
<span><span class="co">#&gt; 1 baseline_1 Control.AFR - Control.EUR Feature_1 -0.10683710 0.5296430</span></span>
<span><span class="co">#&gt; 2 baseline_1 Control.AFR - Control.EUR Feature_2  0.18229653 0.6783480</span></span>
<span><span class="co">#&gt; 3 baseline_1 Control.AFR - Control.EUR Feature_3 -0.66960349 0.2858098</span></span>
<span><span class="co">#&gt; 4 baseline_1 Control.AFR - Control.EUR Feature_4 -0.03846892 0.8395951</span></span>
<span><span class="co">#&gt; 5 baseline_1 Control.AFR - Control.EUR Feature_5  0.15718092 0.1140348</span></span>
<span><span class="co">#&gt; 6 baseline_1 Control.AFR - Control.EUR Feature_6 -0.10661937 0.7439013</span></span>
<span><span class="co">#&gt;       p_adj  ave_expr</span></span>
<span><span class="co">#&gt; 1 0.8682672 12.618695</span></span>
<span><span class="co">#&gt; 2 0.9311933 10.371654</span></span>
<span><span class="co">#&gt; 3 0.8682672  9.929222</span></span>
<span><span class="co">#&gt; 4 0.9433653 12.358806</span></span>
<span><span class="co">#&gt; 5 0.8682672 12.407350</span></span>
<span><span class="co">#&gt; 6 0.9311933  9.058603</span></span></code></pre></div>
<p>The output can easily be filtered for the coefficient of interest and
plotted with the function <code><a href="../reference/plot_volcano.html">plot_volcano()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for interaction effect</span></span>
<span><span class="va">interaction_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">coef_type</span> <span class="op">==</span> <span class="st">"interaction"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">interaction_res</span>, </span>
<span>  x_var <span class="op">=</span> <span class="st">"T_obs"</span>, </span>
<span>  y_var <span class="op">=</span> <span class="st">"p_adj"</span>, </span>
<span>  sig_thr <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>  effect_thr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">interaction_res</span><span class="op">$</span><span class="va">feature</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Volcano plot of the interaction effect"</span>, </span>
<span>  x_label <span class="op">=</span> <span class="st">"Interaction effect (log2FC)"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"FDR corrected p-value (-log10)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_pvalue_distribution.html">plot_pvalue_distribution</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">interaction_res</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"p_value"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"ave_expr"</span>,</span>
<span>  facet_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  facet_levels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"P-value distribution of interaction effects"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"P-value"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  fill_label <span class="op">=</span> <span class="st">"Aver. Expr.\n(logCPM)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="subset_interaction_effect_files/figure-html/volcano_limma_interaction_effect-1.png" alt="Volcano plot" width="50%"><img src="subset_interaction_effect_files/figure-html/volcano_limma_interaction_effect-2.png" alt="Volcano plot" width="50%"></p>
<p>Assuming we found significant</p>
</div>
</div>
<div class="section level2">
<h2 id="single-subset-run">Single subset run<a class="anchor" aria-label="anchor" href="#single-subset-run"></a>
</h2>
<div class="section level3">
<h3 id="stratification-step">Stratification step<a class="anchor" aria-label="anchor" href="#stratification-step"></a>
</h3>
<p>The function <code>split_stratified_ancestry_sets</code> creates a
stratified subset to account for sample size but also control for the
phenotype imbalance in the underrepresented ancestry. The idea is to
create a EUR <code>Train-set</code>, which is the remaining EUR cohort
after subsampling, a EUR-subset <code>Test-set</code> (mimicking the
underrepresented ancestry) based on the compared ancestry
<code>Inferecnce-set</code>. The function
<code>plot_stratified_sets</code> plots the stratified ancestry sets.
The function <code>plot_stratified_feature</code> allows to plot single
or multiple features per split.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Split the data into stratified sets</span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_stratified_ancestry_sets.html">split_stratified_ancestry_sets</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  MX <span class="op">=</span> <span class="va">MX</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">MY</span>,</span>
<span>  g_col <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  a_col <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Stratified split summary:</span></span>
<span><span class="co">#&gt; EUR (Reference, R):    N: 560  Control: 390  Case: 170</span></span>
<span><span class="co">#&gt; EUR (Subset, X):       N: 40   Control: 10   Case: 30</span></span>
<span><span class="co">#&gt; AFR (Inference, Y):    N: 40   Control: 10   Case: 30</span></span>
<span></span>
<span><span class="co"># Visulaize stratified sets</span></span>
<span><span class="fu"><a href="../reference/plot_stratified_sets.html">plot_stratified_sets</a></span><span class="op">(</span></span>
<span>  MX <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  MR <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">R</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Stratified ancestry sets"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Ancestry"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"No. of patients"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visulaize stratified features</span></span>
<span><span class="fu"><a href="../reference/plot_stratified_feature.html">plot_stratified_feature</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>  R <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">R</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>  MX <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  MR <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">R</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Feature counts in stratified ancestry sets"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"Ancestry"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Z-score"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="subset_interaction_effect_files/figure-html/stratification-1.png" alt="Sample balance" width="50%"><img src="subset_interaction_effect_files/figure-html/stratification-2.png" alt="Sample balance" width="50%"></p>
</div>
<div class="section level3">
<h3 id="limma-interaction-effect-on-single-subset">Limma interaction effect on single subset<a class="anchor" aria-label="anchor" href="#limma-interaction-effect-on-single-subset"></a>
</h3>
<p>The function <code>split_stratified_ancestry_sets</code> creates on
subset of the overrepresented ancestry. Note: A single subset only
generates one estimate of the difference it is recomendet to run
multiple subsets to get a more robust estimate of the interaction
effect.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/limma_interaction_effect.html">limma_interaction_effect</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>  MX <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  MY <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>  g_col <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>  a_col <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>  use_voom <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linear model summary:</span></span>
<span><span class="co">#&gt; Formula:        ~0 + groups + sex + age</span></span>
<span><span class="co">#&gt; Groups:         Control.EUR  Case.EUR  Control.AFR  Case.AFR</span></span>
<span><span class="co">#&gt; Baseline:       Control.AFR - Control.EUR  Case.AFR - Case.EUR</span></span>
<span><span class="co">#&gt; Relationship:   Case.EUR - Control.EUR  Case.AFR - Control.AFR</span></span>
<span><span class="co">#&gt; Interaction:    (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">coef_type</span> <span class="op">==</span> <span class="st">"interaction"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       coef_type                                            contrast   feature</span></span>
<span><span class="co">#&gt; 401 interaction (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR) Feature_1</span></span>
<span><span class="co">#&gt; 402 interaction (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR) Feature_2</span></span>
<span><span class="co">#&gt; 403 interaction (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR) Feature_3</span></span>
<span><span class="co">#&gt; 404 interaction (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR) Feature_4</span></span>
<span><span class="co">#&gt; 405 interaction (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR) Feature_5</span></span>
<span><span class="co">#&gt; 406 interaction (Case.AFR - Control.AFR) - (Case.EUR - Control.EUR) Feature_6</span></span>
<span><span class="co">#&gt;          T_obs    p_value     p_adj  ave_expr</span></span>
<span><span class="co">#&gt; 401  1.2186459 0.01163693 0.5036107 12.970857</span></span>
<span><span class="co">#&gt; 402  1.9562581 0.09064993 0.5036107 11.104253</span></span>
<span><span class="co">#&gt; 403  3.0480689 0.03312673 0.5036107 10.577955</span></span>
<span><span class="co">#&gt; 404  1.0454901 0.07158428 0.5036107 12.696330</span></span>
<span><span class="co">#&gt; 405 -0.1412233 0.35553674 0.8228834 12.451729</span></span>
<span><span class="co">#&gt; 406 -0.2792438 0.57859836 0.8358211  9.023236</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="multiple-subset-runs">Multiple subset runs<a class="anchor" aria-label="anchor" href="#multiple-subset-runs"></a>
</h2>
<p>As mentioned, a single subset only generates one estimate of the
difference. To get a more robust estimate of the interaction effect, it
is recommended to run multiple subsets. In this case the pipeline is
similar to run a single subset but with concerns on how to aggregate
over multiple subsets. Because the samples from the underrepresented
ancestry are identical over multiple subsets this introduced dependence.
Hence, aggregating p-values or test statistics is not trivial.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We track the SampleIDs and the summary statisitcs over many subsets</span></span>
<span><span class="va">res_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">id_log</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Stratified ancestry sets</span></span>
<span>  <span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_stratified_ancestry_sets.html">split_stratified_ancestry_sets</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">X</span>,</span>
<span>    Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>    MX <span class="op">=</span> <span class="va">MX</span>,</span>
<span>    MY <span class="op">=</span> <span class="va">MY</span>,</span>
<span>    g_col <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>    a_col <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span> <span class="op">+</span> <span class="va">i</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Store sample ids</span></span>
<span>  <span class="va">id_log</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/track_sample_ids.html">track_sample_ids</a></span><span class="op">(</span><span class="va">split</span>, <span class="va">i</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Limma interaction effects</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/limma_interaction_effect.html">limma_interaction_effect</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>    Y <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">counts</span>,</span>
<span>    MX <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">X</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>    MY <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">Y</span><span class="op">$</span><span class="va">meta</span>,</span>
<span>    g_col <span class="op">=</span> <span class="st">"condition"</span>,</span>
<span>    a_col <span class="op">=</span> <span class="st">"ancestry"</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>    use_voom <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">coef_type</span> <span class="op">==</span> <span class="st">"interaction"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="co"># Store subset runs</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">iteration</span> <span class="op">&lt;-</span> <span class="va">i</span></span>
<span>  <span class="va">res_log</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res_log</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine across iterations</span></span>
<span><span class="va">combined_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">res_log</span><span class="op">)</span></span>
<span><span class="va">combined_id</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">id_log</span><span class="op">)</span></span></code></pre></div>
<p>With this loop we calculated the interaction effect over many
subsets. Hence, we have a p-value for each feature in each subset. We
can plot this distribution of p-values with the function
<code><a href="../reference/plot_pvalue_distribution.html">plot_pvalue_distribution()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize p-value distribution</span></span>
<span><span class="fu"><a href="../reference/plot_pvalue_distribution.html">plot_pvalue_distribution</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">combined_res</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"p_value"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"T_obs"</span>,</span>
<span>  facet_col <span class="op">=</span> <span class="st">"feature"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Histogram of p-values across multiple subsets"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"P-value"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  fill_label <span class="op">=</span> <span class="st">"Log2FC"</span>,</span>
<span>  bins <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  fill_bins <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="subset_interaction_effect_files/figure-html/pvalue%20distribution-1.png" alt="Histogram of p-values across iterations" width="700"></p>
<div class="section level3">
<h3 id="dependence-of-multiple-subsets">Dependence of multiple subsets<a class="anchor" aria-label="anchor" href="#dependence-of-multiple-subsets"></a>
</h3>
<p>From a biological view, feautures with low p-value across subsets are
more likely to be true positives. However, from a statistical
perspective, the p-values are not independent across subsets and hence
to aggregate them it is important to consider. The samples are shared
across the subsets and this sharing of samples can be visualized using
the <code><a href="../reference/plot_jaccard_heatmap.html">plot_jaccard_heatmap()</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_jaccard_heatmap.html">plot_jaccard_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">combined_id</span>,</span>
<span>  role <span class="op">=</span> <span class="st">"X"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Jaccard heatmap of used sampleIDs in subsets"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_jaccard_heatmap.html">plot_jaccard_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">combined_id</span>,</span>
<span>  role <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Jaccard heatmap of used sampleIDs in inference"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="subset_interaction_effect_files/figure-html/jaccard_heatmap-1.png" alt="Jaccard heatmap" width="50%"><img src="subset_interaction_effect_files/figure-html/jaccard_heatmap-2.png" alt="Jaccard heatmap" width="50%"></p>
<p>Correlation of the test statistic and the p-values can be visualized
using the <code><a href="../reference/plot_correlation_heatmap.html">plot_correlation_heatmap()</a></code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_correlation_heatmap.html">plot_correlation_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">combined_res</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"T_obs"</span>,</span>
<span>  iter_col <span class="op">=</span> <span class="st">"iteration"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Test statistic correlation across subsets"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_correlation_heatmap.html">plot_correlation_heatmap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">combined_res</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"p_value"</span>,</span>
<span>  iter_col <span class="op">=</span> <span class="st">"iteration"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"P-value correlation across subsets"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="subset_interaction_effect_files/figure-html/correlation_heatmap-1.png" alt="Correlation heatmap" width="50%"><img src="subset_interaction_effect_files/figure-html/correlation_heatmap-2.png" alt="Correlation heatmap" width="50%"></p>
</div>
<div class="section level3">
<h3 id="aggregation-of-multiple-subsets">Aggregation of multiple subsets<a class="anchor" aria-label="anchor" href="#aggregation-of-multiple-subsets"></a>
</h3>
<p>To aggregate the p-values for each subset we decided on two methods
one is simply taking the mean of the p-values. Another approach is to
use a cauchy-combination test which is possible under abbretrary
dependance. The function to call on multiple subsets is
<code><a href="../reference/summarize_subsets.html">summarize_subsets()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Aggregation of p-values</span></span>
<span><span class="va">aggregated_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_subsets.html">summarize_subsets</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">combined_res</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aggregated_res</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     feature      T_obs    p_value    p_adj  cct_value   cct_adj prob_sig</span></span>
<span><span class="co">#&gt; 1 Feature_1  0.9433479 0.06121674 0.738991 0.04089120 0.6457288        0</span></span>
<span><span class="co">#&gt; 2 Feature_2  1.3356309 0.28316862 0.738991 0.21907536 0.9950796        0</span></span>
<span><span class="co">#&gt; 3 Feature_3  2.3774571 0.10392259 0.738991 0.05783392 0.6457288        0</span></span>
<span><span class="co">#&gt; 4 Feature_4  0.9913829 0.08259291 0.738991 0.05924215 0.6457288        0</span></span>
<span><span class="co">#&gt; 5 Feature_5 -0.1450369 0.40067978 0.738991 0.25437098 0.9950796        0</span></span>
<span><span class="co">#&gt; 6 Feature_6  0.1433863 0.63721534 0.738991 0.86123688 0.9950796        0</span></span>
<span><span class="co">#&gt;    ave_expr</span></span>
<span><span class="co">#&gt; 1 12.983109</span></span>
<span><span class="co">#&gt; 2 11.135611</span></span>
<span><span class="co">#&gt; 3 10.681342</span></span>
<span><span class="co">#&gt; 4 12.756946</span></span>
<span><span class="co">#&gt; 5 12.409589</span></span>
<span><span class="co">#&gt; 6  9.063243</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">aggregated_res</span>, </span>
<span>  x_var <span class="op">=</span> <span class="st">"T_obs"</span>, </span>
<span>  y_var <span class="op">=</span> <span class="st">"p_adj"</span>, </span>
<span>  sig_thr <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>  effect_thr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">interaction_res</span><span class="op">$</span><span class="va">feature</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Volcano plot with mean p-values"</span>, </span>
<span>  x_label <span class="op">=</span> <span class="st">"Interaction effect (log2FC)"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"FDR corrected mean p-value (-log10)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">aggregated_res</span>, </span>
<span>  x_var <span class="op">=</span> <span class="st">"T_obs"</span>, </span>
<span>  y_var <span class="op">=</span> <span class="st">"cct_adj"</span>, </span>
<span>  sig_thr <span class="op">=</span> <span class="fl">0.05</span>, </span>
<span>  effect_thr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">interaction_res</span><span class="op">$</span><span class="va">feature</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Volcano plot with CCT-values"</span>, </span>
<span>  x_label <span class="op">=</span> <span class="st">"Interaction effect (log2FC)"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"FDR corrected cct-value (-log10)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_pvalue_distribution.html">plot_pvalue_distribution</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">aggregated_res</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"p_value"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"ave_expr"</span>,</span>
<span>  facet_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  facet_levels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"P-value distribution"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"P-value"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  fill_label <span class="op">=</span> <span class="st">"Aver. Expr.\n(logCPM)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_pvalue_distribution.html">plot_pvalue_distribution</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">aggregated_res</span>,</span>
<span>  x_var <span class="op">=</span> <span class="st">"cct_value"</span>,</span>
<span>  fill_var <span class="op">=</span> <span class="st">"ave_expr"</span>,</span>
<span>  facet_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  facet_levels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"CCT-value distribution"</span>,</span>
<span>  x_label <span class="op">=</span> <span class="st">"CCT-value"</span>,</span>
<span>  y_label <span class="op">=</span> <span class="st">"Count"</span>,</span>
<span>  fill_label <span class="op">=</span> <span class="st">"Aver. Expr.\n(logCPM)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="subset_interaction_effect_files/figure-html/summarize_subsets-1.png" alt="Two volcano plots" width="50%"><img src="subset_interaction_effect_files/figure-html/summarize_subsets-2.png" alt="Two volcano plots" width="50%"><img src="subset_interaction_effect_files/figure-html/summarize_subsets-3.png" alt="Two volcano plots" width="50%"><img src="subset_interaction_effect_files/figure-html/summarize_subsets-4.png" alt="Two volcano plots" width="50%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Katzlberger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
