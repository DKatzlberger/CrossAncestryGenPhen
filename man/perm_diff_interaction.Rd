% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/perm_diff_interaction.R
\name{perm_diff_interaction}
\alias{perm_diff_interaction}
\title{Permutation-Based Interaction Test with Mandatory Bootstrapped Inference}
\usage{
perm_diff_interaction(
  X,
  Y,
  MX,
  MY,
  g_col,
  a_col,
  seed = NULL,
  B = 1000,
  permute = TRUE,
  min_iter = 500,
  max_iter = 10000,
  tol = 0.001,
  batch_size = 100,
  check_convergence = TRUE
)
}
\arguments{
\item{X}{A numeric matrix of expression values for ancestry A (rows = samples, columns = genes).}

\item{Y}{A numeric matrix of expression values for ancestry B (same format as \code{X}).}

\item{MX}{A data.frame of metadata for \code{X}, must include columns for group and ancestry.}

\item{MY}{A data.frame of metadata for \code{Y}, must include columns for group and ancestry.}

\item{g_col}{Column name in metadata indicating condition/group (factor with 2 levels).}

\item{a_col}{Column name in metadata indicating ancestry (must be unique per ancestry).}

\item{seed}{Optional integer to set random seed for reproducibility.}

\item{B}{Integer. Number of permutations and bootstraps to perform. Set to \code{NULL} for adaptive convergence.}

\item{permute}{Logical. Whether to perform permutation-based interaction testing.}

\item{min_iter}{Minimum number of permutations/bootstraps to run before checking convergence.}

\item{max_iter}{Maximum number of permutations/bootstraps allowed.}

\item{tol}{Tolerance threshold for convergence (applies to empirical p-values and bootstrap SEs).}

\item{batch_size}{Number of permutations/bootstraps to add per iteration.}

\item{check_convergence}{Logical. Whether to check convergence in fixed-\code{B} mode (if \code{permute = TRUE}).}
}
\value{
A list with:
\describe{
  \item{summary_stats}{A data.frame with gene-wise observed statistics (\code{T_obs}),
                       bootstrapped standard errors (\code{SE}),
                       95\% confidence intervals (\code{CI_lower}, \code{CI_upper}),
                       empirical p-values (\code{p_value}, NA if \code{permute = FALSE}),
                       and Benjamini-Hochberg adjusted p-values (\code{p_adj}, NA if \code{permute = FALSE}).}
  \item{T_perm}{Matrix of permutation-based test statistics (or \code{NULL} if \code{permute = FALSE}).}
  \item{T_boot}{Matrix of bootstrap-based observed statistics (rows = bootstraps, columns = genes).}
  \item{B_used_perm}{Number of valid permutations used (or \code{NA} if \code{permute = FALSE}).}
  \item{B_used_boot}{Number of valid bootstrap replicates used.}
  \item{converged_perm}{Logical indicating if permutation p-values converged (or \code{NA} if \code{permute = FALSE}).}
  \item{converged_boot}{Logical indicating if bootstrap SEs converged.}
}
}
\description{
Performs a permutation test (optional) for interaction effects between conditions across ancestries.
Always estimates bootstrapped standard errors and confidence intervals for the observed interaction effects
via resampling within ancestries.
}
\details{
Permutation testing can be toggled using the `permute` flag. When `permute = FALSE`, only bootstrapped
confidence intervals and standard errors are provided, and p-values are returned as NA.

The input expression matrices must have \strong{samples as rows} and \strong{genes as columns}.
}
